(function(){var y,n,f,d,c,g,s={}.hasOwnProperty,o=[].slice;function v(e,t,n,r){this.command=e,this.headers=null!=t?t:{},this.body=null!=n?n:"",this.escapeHeaderValues=null!=r&&r}function e(t){this.ws_fn=function(){var e=t();return e.binaryType="arraybuffer",e},this.reconnect_delay=0,this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData=""}y={LF:"\n",NULL:"\0"},v.prototype.toString=function(){var e,t,n,r=[this.command],i=!1===this.headers["content-length"];for(e in i&&delete this.headers["content-length"],t=this.headers)s.call(t,e)&&(n=t[e],this.escapeHeaderValues&&"CONNECT"!==this.command&&"CONNECTED"!==this.command?r.push(e+":"+v.frEscape(n)):r.push(e+":"+n));return this.body&&!i&&r.push("content-length:"+v.sizeOfUTF8(this.body)),r.push(y.LF+this.body),r.join(y.LF)},v.sizeOfUTF8=function(e){return e?encodeURI(e).match(/%..|./g).length:0},c=function(e,t){var n,r,i,s,o,c,a,u,h,l,p,f,d,g,b,m;for(null==t&&(t=!1),h=e.search(RegExp(""+y.LF+y.LF)),i=(b=e.substring(0,h).split(y.LF)).shift(),s={},m=function(e){return e.replace(/^\s+|\s+$/g,"")},a=0,l=(f=b.reverse()).length;a<l;a++)c=(p=f[a]).indexOf(":"),s[m(p.substring(0,c))]=t&&"CONNECT"!==i&&"CONNECTED"!==i?v.frUnEscape(m(p.substring(c+1))):m(p.substring(c+1));if(n="",b=h+2,s["content-length"])h=parseInt(s["content-length"]),n=(""+e).substring(b,b+h);else for(o=u=d=b,g=e.length;(d<=g?u<g:g<u)&&(r=e.charAt(o))!==y.NULL;o=d<=g?++u:--u)n+=r;return new v(i,s,n,t)},v.unmarshall=function(e,i){var s,o,t;return null==i&&(i=!1),o=e.split(RegExp(""+y.NULL+y.LF+"*")),(t={frames:[],partial:""}).frames=function(){for(var e=o.slice(0,-1),t=[],n=0,r=e.length;n<r;n++)s=e[n],t.push(c(s,i));return t}(),(e=o.slice(-1)[0])===y.LF||-1!==e.search(RegExp(""+y.NULL+y.LF+"*$"))?t.frames.push(c(e,i)):t.partial=e,t},v.marshall=function(e,t,n,r){return new v(e,t,n,r).toString()+y.NULL},v.frEscape=function(e){return(""+e).replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")},v.frUnEscape=function(e){return(""+e).replace(/\\r/g,"\r").replace(/\\n/g,"\n").replace(/\\c/g,":").replace(/\\\\/g,"\\")},f=v,e.prototype.debug=function(e){var t;return"undefined"!=typeof window&&null!==window&&null!=(t=window.console)?t.log(e):void 0},g=function(){return Date.now?Date.now():(new Date).valueOf},e.prototype._transmit=function(e,t,n){var r=f.marshall(e,t,n,this.escapeHeaderValues);for("function"==typeof this.debug&&this.debug(">>> "+r);;){if(!(r.length>this.maxWebSocketFrameSize))return this.ws.send(r);this.ws.send(r.substring(0,this.maxWebSocketFrameSize)),r=r.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+r.length)}},e.prototype._setupHeartbeat=function(i){var t,s;if((r=i.version)===d.VERSIONS.V1_1||r===d.VERSIONS.V1_2){var e,n,r=(o=function(){for(var e=i["heart-beat"].split(","),t=[],n=0,r=e.length;n<r;n++)s=e[n],t.push(parseInt(s));return t}())[0],o=o[1];return 0!==this.heartbeat.outgoing&&0!==o&&(t=Math.max(this.heartbeat.outgoing,o),"function"==typeof this.debug&&this.debug("send PING every "+t+"ms"),this.pinger=d.setInterval(t,(e=this,function(){return e.ws.send(y.LF),"function"==typeof e.debug?e.debug(">>> PING"):void 0}))),0!==this.heartbeat.incoming&&0!==r?(t=Math.max(this.heartbeat.incoming,r),"function"==typeof this.debug&&this.debug("check PONG every "+t+"ms"),this.ponger=d.setInterval(t,(n=this,function(){var e=g()-n.serverActivity;if(2*t<e)return"function"==typeof n.debug&&n.debug("did not receive server activity for the last "+e+"ms"),n.ws.close()}))):void 0}},e.prototype._parseConnect=function(){var e,t,n,r=1<=arguments.length?o.call(arguments,0):[],i={};if(r.length<2)throw"Connect requires at least 2 arguments";return"function"==typeof r[1]?(i=r[0],t=r[1],n=r[2],e=r[3]):6===r.length?(i.login=r[0],i.passcode=r[1],t=r[2],n=r[3],e=r[4],i.host=r[5]):(i.login=r[0],i.passcode=r[1],t=r[2],n=r[3],e=r[4]),[i,t,n,e]},e.prototype.connect=function(){var e=1<=arguments.length?o.call(arguments,0):[];return this.escapeHeaderValues=!1,e=this._parseConnect.apply(this,e),this.headers=e[0],this.connectCallback=e[1],this.errorCallback=e[2],this.closeEventCallback=e[3],this._active=!0,this._connect()},e.prototype._connect=function(){var h,l,n,e,t=this.headers,p=this.errorCallback,r=this.closeEventCallback;if(this._active)return"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws=this.ws_fn(),h=function(e){for(var t,n,r,i="",s=e.length,o=0;o<s;)switch((t=e[o++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i+=String.fromCharCode(t);break;case 12:case 13:n=e[o++],i+=String.fromCharCode((31&t)<<6|63&n);break;case 14:n=e[o++],r=e[o++],i+=String.fromCharCode((15&t)<<12|(63&n)<<6|(63&r)<<0)}return i},this.ws.onmessage=(l=this,function(e){var t,n,r,i,s,o,c,a,u,e="undefined"!=typeof ArrayBuffer&&e.data instanceof ArrayBuffer?(t=new Uint8Array(e.data),"function"==typeof l.debug&&l.debug("--- got data length: "+t.length),h(t)):e.data;if(l.serverActivity=g(),e!==y.LF)for("function"==typeof l.debug&&l.debug("<<< "+e),e=f.unmarshall(l.partialData+e,l.escapeHeaderValues),l.partialData=e.partial,i=0,s=(a=e.frames).length;i<s;i++)switch((r=a[i]).command){case"CONNECTED":if("function"==typeof l.debug&&l.debug("connected to server "+r.headers.server),l.connected=!0,l.version=r.headers.version,l.version===d.VERSIONS.V1_2&&(l.escapeHeaderValues=!0),!l._active)return void l.disconnect();l._setupHeartbeat(r.headers),"function"==typeof l.connectCallback&&l.connectCallback(r);break;case"MESSAGE":u=r.headers.subscription,(c=l.subscriptions[u]||l.onreceive)?(o=(n=l).version===d.VERSIONS.V1_2?r.headers.ack:r.headers["message-id"],r.ack=function(e){return null==e&&(e={}),n.ack(o,u,e)},r.nack=function(e){return null==e&&(e={}),n.nack(o,u,e)},c(r)):"function"==typeof l.debug&&l.debug("Unhandled received MESSAGE: "+r);break;case"RECEIPT":r.headers["receipt-id"]===l.closeReceipt?(l.ws.onclose=null,l.ws.close(),l._cleanUp(),"function"==typeof l._disconnectCallback&&l._disconnectCallback()):"function"==typeof l.onreceipt&&l.onreceipt(r);break;case"ERROR":"function"==typeof p&&p(r);break;default:"function"==typeof l.debug&&l.debug("Unhandled frame: "+r)}else"function"==typeof l.debug&&l.debug("<<< PONG")}),this.ws.onclose=(n=this,function(e){var t="Whoops! Lost connection to "+n.ws.url;return"function"==typeof n.debug&&n.debug(t),"function"==typeof r&&r(e),n._cleanUp(),"function"==typeof p&&p(t),n._schedule_reconnect()}),this.ws.onopen=(e=this,function(){return"function"==typeof e.debug&&e.debug("Web Socket Opened..."),t["accept-version"]=d.VERSIONS.supportedVersions(),t["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(","),e._transmit("CONNECT",t)});this.debug("Client has been marked inactive, will not attempt to connect")},e.prototype._schedule_reconnect=function(){if(0<this.reconnect_delay)return"function"==typeof this.debug&&this.debug("STOMP: scheduling reconnection in "+this.reconnect_delay+"ms"),this._reconnector=setTimeout(function(){return e.connected?"function"==typeof e.debug?e.debug("STOMP: already connected"):void 0:("function"==typeof e.debug&&e.debug("STOMP: attempting to reconnect"),e._connect())},(e=this).reconnect_delay);var e},e.prototype.disconnect=function(e,t){if(null==t&&(t={}),this._disconnectCallback=e,this._active=!1,this.connected){t.receipt||(t.receipt="close-"+this.counter++),this.closeReceipt=t.receipt;try{return this._transmit("DISCONNECT",t)}catch(e){return"function"==typeof this.debug?this.debug("Ignoring error during disconnect",e):void 0}}},e.prototype._cleanUp=function(){if(this._reconnector&&clearTimeout(this._reconnector),this.connected=!1,this.subscriptions={},this.partial="",this.pinger&&d.clearInterval(this.pinger),this.ponger)return d.clearInterval(this.ponger)},e.prototype.send=function(e,t,n){return null==t&&(t={}),null==n&&(n=""),t.destination=e,this._transmit("SEND",t,n)},e.prototype.subscribe=function(e,t,n){var r;return null==n&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=e,this.subscriptions[n.id]=t,this._transmit("SUBSCRIBE",n),r=this,{id:n.id,unsubscribe:function(e){return r.unsubscribe(n.id,e)}}},e.prototype.unsubscribe=function(e,t){return null==t&&(t={}),delete this.subscriptions[e],t.id=e,this._transmit("UNSUBSCRIBE",t)},e.prototype.begin=function(e){var t,n=e||"tx-"+this.counter++;return this._transmit("BEGIN",{transaction:n}),t=this,{id:n,commit:function(){return t.commit(n)},abort:function(){return t.abort(n)}}},e.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})},e.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})},e.prototype.ack=function(e,t,n){return null==n&&(n={}),this.version===d.VERSIONS.V1_2?n.id=e:n["message-id"]=e,n.subscription=t,this._transmit("ACK",n)},e.prototype.nack=function(e,t,n){return null==n&&(n={}),this.version===d.VERSIONS.V1_2?n.id=e:n["message-id"]=e,n.subscription=t,this._transmit("NACK",n)},n=e,d={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.2,1.1,1.0"}},client:function(e,t){return null==t&&(t=["v10.stomp","v11.stomp","v12.stomp"]),new n(function(){return new(d.WebSocketClass||WebSocket)(e,t)})},over:function(e){return new n("function"==typeof e?e:function(){return e})},Frame:f,setInterval:function(e,t){return setInterval(t,e)},clearInterval:function(e){return clearInterval(e)}},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=d),"undefined"!=typeof window&&null!==window?window.Stomp=d:exports||(self.Stomp=d)}).call(this);