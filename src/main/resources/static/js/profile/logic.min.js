import autosize from"/js/autosize.js";let loadCommentsButton=document.getElementById("loadComments");loadCommentsButton.addEventListener("click",e=>{$("#loadComments").remove();let t=$(".comments-content");t.css("align-items","");let n=hasMyAvatar?`<img src="data:image/webp;base64,${avatars[currentName].avatar}" id="avatarComments">`:'<img src="/img/UnsetAvatar.webp" id="avatarComments" alt="">\n';t.append(' <div class="writeCommentSuggestionDiv">\n<div style="display: flex;gap:50px;">\n<div  class="avatar-wrapper-medium avatar-wrapper" style="min-width: 72px;max-width:72px;min-height: 72px;max-height:72px;border: none !important;">\n'+`<a href="/profile">\n${n}\n</a>\n`+'</div>\n<form content="0" id="sendCommentForm" method="POST" action="/createComment" style="width: 100%">\n<textarea style="position: relative" minlength="1" maxlength="300" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." name="content" id="content"></textarea>\n'+`<input type="hidden" name="receiver" id="receiver" value="${name}">\n`+'</form>\n</div>\n<div style="margin-top:5px">\n<input type="submit" id="sendButton">\n</div>\n</div>'),t.append('<div id="theDiv">\n            \n        </div>');let a=document.getElementById("content"),i=document.getElementById("sendButton"),o=!0,s=document.getElementById("sendCommentForm"),r=()=>{0===a.value.length?(i.style.visibility="hidden",o=!0):o&&(i.style.visibility="visible",o=!1)};a.addEventListener("input",()=>{r();let e=a.value.length;s.setAttribute("content",e)});const l=()=>{autosize(document.getElementsByClassName("toBeAutoGrown"))};let d=null;function m(){let e=new SockJS("/listenToNewEvents");(d=Stomp.over(e)).connect({},function(){d.subscribe("/user/"+name+"/queue/messages",function(e){!function(e){if(null===name||e.username===currentName)g(e);else{let t=document.getElementById("loadNewComments");if(null==t){let e='<button style="position: absolute;top:112px;left: 430px" id="loadNewComments">–ù–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</button>';$(e).insertAfter("#content"),(t=document.getElementById("loadNewComments")).addEventListener("click",function(e){e.preventDefault(),$(v).each(function(e,t){g(t)}),v=[],$("#loadNewComments").remove()})}v.push(e),$("#content").val(""),s.setAttribute("content",0),r()}}(JSON.parse(e.body))}),d.subscribe("/user/"+name+"/queue/changeLikeAmount",function(e){let t=JSON.parse(e.body).split(" ");document.querySelector(`p[content="${t[0]}"] .rating`).textContent=t[1]})},function(){console.log("Error connecting...")})}$(document).ready(function(){m(),autosize(a)});let c=document.getElementById("theDiv"),u=new Map;function p(e){let t=null,n=Object.keys(e).includes("author")?"author":"username";var a;return t=null==e[n]||null==avatars[e[n]]||null==avatars[e[n]].avatar?`<img src="/img/UnsetAvatar.webp" style="width:72px;height: 72px;" alt="${e.tempName}'s avatar">`:`<img src="data:image/webp;base64,${avatars[e[n]].avatar}" style="width:72px;height: 72px;" alt="${e[n]}'s avatar">`,`<div style="margin-top:70px;position: relative" class="comment">\n                <div style="color:#e1e1e1;font-size:11px;position: absolute;right: 0;width: 100%;height: 20px;top:-21px;display: flex;justify-content: flex-end">${e.stringDate}</div>\n                <div style="position:relative; display: flex;gap:50px;">\n                <div>\n                    <div class="avatar-wrapper-medium avatar-wrapper" style="position: relative;border: none !important;max-width: 72px;min-width: 72px;min-height: 72px;max-height: 72px;">\n                        <a style="position: relative" href="/profile/${e[n]}">\n                        ${t}\n                    </a>\n                </div>\n                <div style="position: relative">\n                    <a href="/profile/${e[n]}" style="text-decoration:none;position: absolute;left: 50%;transform: translate(-50%, 0);top: 12px;color: white;font-size: 14px;">${e[n]}</a>\n                </div>\n                </div>\n                <textarea readonly style="cursor: pointer;overflow: hidden;overflow-wrap:break-word;" class="toBeAutoGrown">${e.content}</textarea>\n            </div>\n                <div style="display: flex;justify-content: flex-end;position: absolute;right: 2px;height: 20px;width: 100%  ">\n                    <p content="${e.id}" style="color: white"><span style="font-size: 14px;cursor:pointer"  class="dislike">üëé</span><span class="rating" style="font-size:14px;margin-left: 5px;margin-right: 5px">${a=e.rating,Math.abs(a)>999?Math.sign(a)*(Math.abs(a)/1e3).toFixed(1)+"K":Math.sign(a)*Math.abs(a)}</span><span style="font-size: 15px;cursor:pointer" class="like">üëç</span></p>\n                </div>\n            </div>`}c.addEventListener("click",e=>{let t=e.target;if("SPAN"==t.nodeName&&("üëç"==t.textContent||"üëé"==t.textContent)){let e=t.parentElement.getAttribute("content");if(u.has(e)){let t=u.get(e);clearTimeout(t)}u.set(e,setTimeout(()=>{!function(e,t,n){d.send("/application/changeLikeAmount",{},JSON.stringify({id:e,username:name,like:"üëç"==t})),n.delete(e)}(e,t.textContent,u)},1500))}}),window.onbeforeunload=function(){socket.onclose=function(){},socket.close()},$("#sendButton").on("click",function(){d.send("/application/sendComment",{},JSON.stringify({username:currentName,recipient:name,content:$("#content").val(),date:(new Date).getTime(),isActive:1}))});let v=[];function g(e){let t=p(e);$("#theDiv").prepend(t),$("#content").val(""),s.setAttribute("content",0),r(),l()}if(totalPages>=1){let e=0;const t=t=>{let n=t.r,a=t.t,i=Object.keys(n);if(0!=i.length)for(let e=0;e<i.length;e++)Object.defineProperty(avatars,i[e],{value:n[i[e]]});$(a).each(function(t,n){let a=p(n);totalPages==e?($("#theDiv").append(a),$("#loadMoreButtonDiv").remove()):$(a).insertBefore("#loadMoreButtonDiv")})};$(document).ready(function(){totalPages>=2&&($("#theDiv").append('<div id="loadMoreButtonDiv" style="margin-top: 100px;width: 100%;text-align: center;">\n                <button id="loadMoreButton">–ë–æ–ª—å—à–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</button>\n            </div>'),$("#loadMoreButton").click(function(n){n.preventDefault(),e+=1,$.ajax({url:"/ajax/nextComments",data:{usersWhoseAvatarsAreLoaded:Object.keys(avatars).join(","),currentPage:e,user:name},success:t})})),$.ajax({url:"/ajax/nextComments",data:{usersWhoseAvatarsAreLoaded:Object.keys(avatars).join(","),currentPage:e,user:name},success:t}),e=1})}});